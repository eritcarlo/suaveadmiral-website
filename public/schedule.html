<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Manage Barber Schedule - Suave Barbershop</title>
    <link rel="stylesheet" href="admin.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
      /* Navbar styling to match homepage exactly */
      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(207, 12, 2, 0.2);
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
        /* Notification Dropdown Styles (copied from admin page) */
        .notification-bell {
          position: relative;
          cursor: pointer;
          margin-right: 1rem;
        }
        .notification-dropdown {
          display: none;
          position: absolute;
          top: 50px;
          right: 0;
          background: white;
          border-radius: 12px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
          width: 350px;
          max-height: 400px;
          z-index: 1000;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }
        .notification-dropdown.show {
          display: block;
          animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .notification-dropdown-header {
          background: #f8f9fa;
          padding: 15px 20px;
          border-bottom: 1px solid #e5e7eb;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        .notification-dropdown-header h4 {
          margin: 0;
          color: #1f2937;
          font-size: 16px;
          font-weight: 600;
        }
        .mark-all-read {
          background: #cf0c02;
          border: none;
          color: white;
          padding: 6px 10px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 12px;
          transition: background 0.3s;
        }
        .mark-all-read:hover {
          background: #a30901;
        }
        .notification-dropdown-content {
          max-height: 320px;
          overflow-y: auto;
          padding: 10px 0;
        }
        .notification-dropdown-content::-webkit-scrollbar {
          width: 6px;
        }
        .notification-dropdown-content::-webkit-scrollbar-track {
          background: #f1f1f1;
        }
        .notification-dropdown-content::-webkit-scrollbar-thumb {
          background: #cf0c02;
          border-radius: 3px;
        }
        .notification-dropdown-item {
          padding: 12px 20px;
          border-bottom: 1px solid #f3f4f6;
          cursor: pointer;
          transition: background 0.2s;
          color: #374151;
        }
        .notification-dropdown-item:hover {
          background: #f9fafb;
        }
        .notification-dropdown-item:last-child {
          border-bottom: none;
        }
        .notification-dropdown-item.unread {
          background: #eff6ff;
          border-left: 3px solid #3b82f6;
        }
        .notification-dropdown-item.unread:hover {
          background: #dbeafe;
        }
        .notification-message {
          font-size: 14px;
          line-height: 1.4;
          margin-bottom: 4px;
          color: #374151;
        }
        .notification-date {
          font-size: 12px;
          color: #6b7280;
        }
        .notification-loading, .no-notifications {
          text-align: center;
          padding: 20px;
          color: #6b7280;
          font-size: 14px;
        }
        .no-notifications {
          font-style: italic;
        }
        @media (max-width: 768px) {
          .notification-dropdown {
            width: 300px;
            right: -20px;
          }
        }
        @media (max-width: 480px) {
          .notification-dropdown {
            width: 280px;
            right: -40px;
          }
        }

      .navbar img {
        height: 60px;
        margin-right: 18px;
        transition: transform 0.3s ease;
      }

      .navbar img:hover {
        transform: scale(1.1);
      }

      .navbar h1 {
        font-family: "Great Vibes", cursive;
        font-size: 2.5rem;
        margin: 0;
        color: #cf0c02;
        text-shadow: 2px 2px 10px rgba(207, 12, 2, 0.5);
        flex-grow: 1;
        margin-left: 1rem;
      }

      .navbar ul {
        list-style: none;
        display: flex;
        margin: 0;
        padding: 0;
        gap: 2rem;
        margin-left: auto;
        margin-right: 2rem;
      }

      .navbar ul li {
        display: inline;
      }

      .navbar ul li a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        font-size: 1rem;
        transition: all 0.3s ease;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        position: relative;
      }

      .navbar ul li a::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: #cf0c02;
        transition: all 0.3s ease;
        transform: translateX(-50%);
      }

      .navbar ul li a:hover::before {
        width: 100%;
      }

      .navbar ul li a:hover {
        color: #cf0c02;
        background: rgba(207, 12, 2, 0.1);
      }

      /* Active state for current page */
      .navbar ul li a.active {
        color: #cf0c02;
        background: rgba(207, 12, 2, 0.15);
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(207, 12, 2, 0.2);
      }

      .navbar ul li a.active::before {
        width: 100%;
      }

      .logout-btn {
        background: #e74c3c;
        border: none;
        padding: 0.5rem 1rem;
        color: white;
        font-size: 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.3s ease;
        font-weight: 600;
      }

      .logout-btn:hover {
        background: #c0392b;
      }

      /* Responsive navbar */
      @media (max-width: 768px) {
        .navbar {
          padding: 0.5rem 1rem;
          flex-wrap: wrap;
        }
        
        .navbar ul {
          gap: 0.5rem;
          margin-right: 1rem;
          flex-wrap: wrap;
        }
        
        .navbar ul li a {
          font-size: 0.8rem;
          padding: 0.3rem 0.6rem;
        }
        
        .navbar h1 {
          font-size: 1.8rem;
          margin-left: 0.5rem;
        }
        
        .navbar img {
          height: 50px;
          margin-right: 10px;
        }
      }

      @media (max-width: 1024px) {
        .navbar ul {
          gap: 1rem;
        }
        
        .navbar ul li a {
          font-size: 0.9rem;
          padding: 0.4rem 0.8rem;
        }
      }

      .schedule-container {
        max-width: 1200px;
        margin: 40px auto;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.3);
        padding: 30px;
        border: 1px solid rgba(207, 12, 2, 0.2);
      }
      h2 {
        font-size: 28px;
        color: #cf0c02;
        margin-bottom: 30px;
        text-align: center;
      }
      .schedule-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .barber-schedule {
        background: rgba(45, 45, 45, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 20px;
        border: 2px solid rgba(207, 12, 2, 0.3);
      }
      .barber-name {
        font-size: 20px;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 15px;
        text-align: center;
      }
      .time-slot {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 15px;
        margin: 5px 0;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffffff;
        transition: all 0.3s ease;
      }
      .time-slot:hover {
        background: rgba(0, 0, 0, 0.8);
        transform: translateX(5px);
      }
      .time-slot.available {
        border-color: #28a745;
        background: rgba(40, 167, 69, 0.2);
      }
      .time-slot.unavailable {
        border-color: #dc3545;
        background: rgba(220, 53, 69, 0.2);
      }
      .time-slot.booked {
        border-color: #ffc107;
        background: rgba(255, 193, 7, 0.2);
      }
      .slot-time {
        font-weight: bold;
        font-size: 16px;
        color: #ffffff;
      }
      .slot-actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .slot-actions button {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
        transition: all 0.3s ease;
      }
      .toggle-btn {
        background: #007bff;
        color: white;
      }
      .toggle-btn:hover {
        background: #0056b3;
      }
      .toggle-btn.available {
        background: #28a745;
      }
      .toggle-btn.available:hover {
        background: #218838;
      }
      .edit-timeslot-btn, .edit-btn {
        background: #ffc107;
        color: #000;
        padding: 4px 8px;
      }
      .edit-timeslot-btn:hover, .edit-btn:hover {
        background: #e0a800;
      }
      .delete-timeslot-btn, .delete-btn {
        background: #dc3545;
        color: white;
        padding: 4px 8px;
      }
      .delete-timeslot-btn:hover, .delete-btn:hover {
        background: #c82333;
      }
      .timeslot-edit-form {
        display: none;
        margin-top: 10px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
        gap: 10px;
        align-items: center;
      }
      .timeslot-edit-form input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.9);
        color: #000;
      }
      .save-timeslot-btn, .cancel-timeslot-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        margin-left: 5px;
      }
      .save-timeslot-btn {
        background: #28a745;
        color: white;
      }
      .cancel-timeslot-btn {
        background: #6c757d;
        color: white;
      }
      .barber-schedule {
        background: rgba(45, 45, 45, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 20px;
        border: 2px solid rgba(207, 12, 2, 0.3);
      }
      .barber-name {
        font-size: 20px;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 15px;
        text-align: center;
      }
      .time-slot {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 15px;
        margin: 5px 0;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffffff;
      }
      .time-slot.available {
        border-color: #28a745;
        background: rgba(40, 167, 69, 0.2);
      }
      .time-slot.unavailable {
        border-color: #dc3545;
        background: rgba(220, 53, 69, 0.2);
      }
      .time-slot.booked {
        border-color: #ffc107;
        background: rgba(255, 193, 7, 0.2);
      }
      .toggle-btn {
        background: #cf0c02;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
      }
      .toggle-btn.available {
        background: #28a745;
      }
      .toggle-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .toggle-btn:hover:not(:disabled) {
        opacity: 0.8;
      }
      .date-filter {
        text-align: center;
        margin-bottom: 20px;
      }
      .date-filter input {
        padding: 10px;
        border: 2px solid rgba(207, 12, 2, 0.3);
        border-radius: 5px;
        font-size: 16px;
        background: rgba(45, 45, 45, 0.9);
        color: #ffffff;
        backdrop-filter: blur(10px);
      }
      .date-filter input:focus {
        outline: none;
        border-color: #cf0c02;
        box-shadow: 0 0 10px rgba(207, 12, 2, 0.3);
      }
      .date-filter input::-webkit-datetime-edit,
      .date-filter input::-webkit-datetime-edit-fields-wrapper,
      .date-filter input::-webkit-datetime-edit-text,
      .date-filter input::-webkit-datetime-edit-month-field,
      .date-filter input::-webkit-datetime-edit-day-field,
      .date-filter input::-webkit-datetime-edit-year-field {
        color: #ffffff;
        background: transparent;
      }
      .date-filter input::-webkit-calendar-picker-indicator {
        filter: invert(1);
        cursor: pointer;
      }
      .date-filter button {
        background: linear-gradient(135deg, #cf0c02 0%, #a30a00 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        margin-left: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(207, 12, 2, 0.3);
      }
      .date-filter button:hover {
        background: linear-gradient(135deg, #a30a00 0%, #8b0800 100%);
        transform: translateY(-1px);
      }
      .barber-presence {
        background: rgba(45, 45, 45, 0.9);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(207, 12, 2, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .barber-presence h3 {
        color: #ffffff;
        margin-top: 0;
        margin-bottom: 15px;
      }
      .presence-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }
        .presence-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 10px;
          padding: 18px 10px 14px 10px;
          min-height: 140px;
          min-width: 160px;
          box-sizing: border-box;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .presence-item:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 25px rgba(207, 12, 2, 0.3);
        }
        .barber-avatar {
          width: 70px;
          height: 70px;
          border-radius: 12px;
          object-fit: cover;
          background: #222;
          border: 2px solid #cf0c02;
          box-shadow: 0 2px 8px rgba(0,0,0,0.12);
          margin-bottom: 8px;
          margin-right: 0;
          flex-shrink: 0;
          display: block;
        }
        .presence-item span {
          text-align: center;
          word-break: break-word;
          font-size: 1rem;
          margin-bottom: 6px;
        }
        .presence-toggle {
          margin-top: 2px;
        }
      .presence-item {
        background: rgba(0, 0, 0, 0.6);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #ffffff;
      }
      .presence-item.present {
        border-color: #28a745;
        background: rgba(40, 167, 69, 0.2);
      }
      .presence-item.absent {
        border-color: #dc3545;
        background: rgba(220, 53, 69, 0.2);
      }
      .presence-toggle {
        background: #28a745;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
      }
      .presence-toggle.absent {
        background: #dc3545;
      }
      .add-timeslot-section {
        background: rgba(45, 45, 45, 0.9);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(207, 12, 2, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .add-timeslot-section h3 {
        color: #ffffff;
        margin-top: 0;
        margin-bottom: 15px;
      }
      .timeslot-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        align-items: end;
      }
      .timeslot-form select,
      .timeslot-form input {
        padding: 8px 12px;
        border: 1px solid rgba(207, 12, 2, 0.3);
        border-radius: 5px;
        font-size: 14px;
        background: rgba(0, 0, 0, 0.6);
        color: #ffffff;
        backdrop-filter: blur(10px);
      }
      .timeslot-form select:focus,
      .timeslot-form input:focus {
        outline: none;
        border-color: #cf0c02;
        box-shadow: 0 0 10px rgba(207, 12, 2, 0.3);
      }
      .timeslot-form select option {
        background: #2d2d2d;
        color: #ffffff;
      }
      .add-timeslot-btn {
        background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(40, 167, 69, 0.3);
      }
      .add-timeslot-btn:hover {
        background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
        transform: translateY(-1px);
      }
      .timeslot-actions {
        display: flex;
        gap: 5px;
        margin-left: 10px;
      }
      .edit-timeslot-btn,
      .delete-timeslot-btn {
        background: #6c757d;
        color: white;
        border: none;
        padding: 3px 8px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 10px;
        transition: background-color 0.2s;
      }
      .edit-timeslot-btn {
        background: #17a2b8;
      }
      .delete-timeslot-btn {
        background: #dc3545;
      }
      .edit-timeslot-btn:hover:not(:disabled) {
        background: #138496;
      }
      .delete-timeslot-btn:hover:not(:disabled) {
        background: #c82333;
      }
      .edit-timeslot-btn:disabled,
      .delete-timeslot-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .timeslot-edit-form {
        display: none;
        margin-top: 5px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 5px;
        border: 1px solid rgba(207, 12, 2, 0.3);
      }
      .timeslot-edit-form input {
        width: 120px;
        margin-right: 10px;
        background: rgba(45, 45, 45, 0.9);
        color: #ffffff;
        border: 1px solid rgba(207, 12, 2, 0.3);
      }
      .save-timeslot-btn,
      .cancel-timeslot-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        margin-right: 5px;
      }
      .save-timeslot-btn {
        background: #28a745;
        color: white;
      }
      .cancel-timeslot-btn {
        background: #6c757d;
        color: white;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(45, 45, 45, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(207, 12, 2, 0.3);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        text-align: center;
        min-width: 300px;
        max-width: 500px;
        animation: modalSlideIn 0.3s ease-out;
        color: #ffffff;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translate(-50%, -60%);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%);
        }
      }

      .close,
      .close-confirm {
        position: absolute;
        top: 15px;
        right: 20px;
        color: #cccccc;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s;
      }

      .close:hover,
      .close:focus,
      .close-confirm:hover,
      .close-confirm:focus {
        color: #cf0c02;
      }

      #modal-message,
      #confirm-message {
        font-size: 16px;
        color: #ffffff;
        margin: 20px 0;
        line-height: 1.5;
      }

      .modal-btn {
        background: #cf0c02;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px 5px;
      }

      .modal-btn:hover {
        background: #a50a02;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(207, 12, 2, 0.3);
      }

      .modal-btn:active {
        transform: translateY(0);
      }

      /* Confirmation modal specific styles */
      .confirm-btn {
        background: #cf0c02;
      }

      .confirm-btn:hover {
        background: #a50a02;
      }

      .cancel-btn.modal-btn {
        background: #6c757d;
      }

      .cancel-btn.modal-btn:hover {
        background: #545b62;
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
      }

      #modal-buttons,
      #confirm-buttons {
        margin-top: 20px;
      }

      /* Responsive adjustments for modal */
      @media (max-width: 500px) {
        .modal-content {
          margin: 20px;
          min-width: auto;
          max-width: calc(100% - 40px);
        }
        
        .modal-btn {
          padding: 10px 20px;
          font-size: 14px;
        }
      }


    </style>
  </head>
  <body>
    <!-- Navbar - Updated to match admin page -->
    <nav class="navbar">
      <img
        src="suavelogo.png"
        alt="Suave Logo"
      />
      <h1>Suave Admin</h1>
      <ul>
        <li><a href="/admin" class="nav-link">Dashboard</a></li>
        <li><a href="/appointments" class="nav-link">View Appointments</a></li>
        <li><a href="/schedule" class="nav-link active">Barber Schedule</a></li>
        <li><a href="/qr-settings" class="nav-link">QR Settings</a></li>
        <li><a href="/barber-management" class="nav-link">Barber Management</a></li>
      </ul>
        <!-- Notification Bell -->
        <div class="notification-bell" id="adminNotificationBell">
          <i class="fas fa-bell"></i>
          <span id="adminNotificationCount" class="notification-count" style="display: none;">0</span>
          <div class="notification-dropdown" id="adminNotificationDropdown">
            <div class="notification-dropdown-header">
              <h4>Booking Notifications</h4>
              <button id="adminMarkAllReadBtn" class="mark-all-read">Mark all as read</button>
            </div>
            <div class="notification-dropdown-content" id="adminNotificationDropdownContent">
              <div class="notification-loading">Loading notifications...</div>
            </div>
          </div>
        </div>
        <button id="logoutBtn" class="logout-btn">Logout</button>
    </nav>

    <div class="schedule-container">
      <h2>Manage Barber Schedules</h2>

      <!-- Date Filter -->
      <div class="date-filter">
  <label for="schedule-date">Select Date: </label>
  <input type="date" id="schedule-date" />
  <button onclick="loadSchedules()">Load Schedule</button>
  <button id="openAddTimeslotModal" style="margin-left:10px;background:linear-gradient(135deg,#28a745 0%,#218838 100%);color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;font-weight:bold;transition:all 0.3s ease;box-shadow:0 2px 10px rgba(40,167,69,0.3);">Add Timeslot</button>
      </div>

      <!-- Barber Presence Management -->
      <div class="barber-presence">
        <h3>Barber Presence Management</h3>
        <div id="barber-presence-list" class="presence-list">
          <!-- Barber presence controls will be loaded here -->
        </div>
      </div>

      <!-- Add Timeslot Modal -->
      <div id="addTimeslotModal" class="modal">
        <div class="modal-content" style="max-width:420px;">
          <span class="close" id="closeAddTimeslotModal">&times;</span>
          <h3 style="color:#fff;margin-top:0;margin-bottom:15px;">Add New Timeslot</h3>
          <form id="addTimeslotForm" class="timeslot-form" style="display:grid;grid-template-columns:1fr;gap:15px;">
            <div>
              <label for="timeslot-barber-select">Select Barber:</label><br>
              <select id="timeslot-barber-select" style="width:100%;">
                <option value="">Choose a barber...</option>
              </select>
            </div>
            <div>
              <label for="timeslot-time-input">Time:</label><br>
              <input type="text" id="timeslot-time-input" placeholder="e.g., 09:00 AM" style="width:100%;" />
            </div>
            <div>
              <label for="timeslot-date-input">Available Date (Optional):</label><br>
              <input type="date" id="timeslot-date-input" style="width:100%;" />
            </div>
            <div style="text-align:right;">
              <button type="submit" class="add-timeslot-btn">Add Timeslot</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Schedule Grid -->
      <div id="schedule-grid" class="schedule-grid">
        <!-- Barber schedules will be loaded here -->
      </div>
    </div>

    <!-- Modal Dialog -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-message"></div>
        <div id="modal-buttons">
          <button id="modal-ok" class="modal-btn">OK</button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
      <div class="modal-content">
        <span class="close-confirm">&times;</span>
        <div id="confirm-message"></div>
        <div id="confirm-buttons">
          <button id="confirm-yes" class="modal-btn confirm-btn">Yes</button>
          <button id="confirm-no" class="modal-btn cancel-btn">No</button>
        </div>
      </div>
    </div>



    <script>
      // Add Timeslot Modal logic
      const addTimeslotModal = document.getElementById('addTimeslotModal');
      const openAddTimeslotBtn = document.getElementById('openAddTimeslotModal');
      const closeAddTimeslotBtn = document.getElementById('closeAddTimeslotModal');
      openAddTimeslotBtn.onclick = function() {
        addTimeslotModal.style.display = 'block';
      };
      closeAddTimeslotBtn.onclick = function() {
        addTimeslotModal.style.display = 'none';
      };
      window.addEventListener('click', function(event) {
        if (event.target === addTimeslotModal) {
          addTimeslotModal.style.display = 'none';
        }
      });
      document.getElementById('addTimeslotForm').onsubmit = async function(e) {
        e.preventDefault();
        await addNewTimeslot();
        addTimeslotModal.style.display = 'none';
      };
      // Modal functions
      function showModal(message) {
        document.getElementById("modal-message").textContent = message;
        document.getElementById("modal").style.display = "block";
      }

      function hideModal() {
        document.getElementById("modal").style.display = "none";
      }

      // Confirmation modal functions
      function showConfirmModal(message) {
        return new Promise((resolve) => {
          document.getElementById("confirm-message").textContent = message;
          document.getElementById("confirm-modal").style.display = "block";
          
          const yesBtn = document.getElementById("confirm-yes");
          const noBtn = document.getElementById("confirm-no");
          const closeBtn = document.querySelector(".close-confirm");
          
          function cleanup() {
            yesBtn.removeEventListener("click", handleYes);
            noBtn.removeEventListener("click", handleNo);
            closeBtn.removeEventListener("click", handleNo);
            document.getElementById("confirm-modal").style.display = "none";
          }
          
          function handleYes() {
            cleanup();
            resolve(true);
          }
          
          function handleNo() {
            cleanup();
            resolve(false);
          }
          
          yesBtn.addEventListener("click", handleYes);
          noBtn.addEventListener("click", handleNo);
          closeBtn.addEventListener("click", handleNo);
        });
      }

      // Modal event listeners
      document.querySelector(".close").addEventListener("click", hideModal);
      document.getElementById("modal-ok").addEventListener("click", hideModal);
      document.getElementById("modal").addEventListener("click", function (e) {
        if (e.target === this) hideModal();
      });

      document.getElementById("confirm-modal").addEventListener("click", function (e) {
        if (e.target === this) {
          document.getElementById("confirm-modal").style.display = "none";
        }
      });

      // Set default date to today
      document.getElementById("schedule-date").value = new Date()
        .toISOString()
        .split("T")[0];

      // Load barber schedules
      async function loadSchedules(date = null) {
        try {
          // Show loading state
          const scheduleGrid = document.getElementById("schedule-grid");
          scheduleGrid.classList.add("loading");

          const selectedDate = date || document.getElementById("schedule-date").value;
          const url = selectedDate
            ? `/api/admin/barber-schedules?date=${selectedDate}`
            : "/api/admin/barber-schedules";
          
          console.log("Loading schedules from:", url);
          
          const res = await fetch(url);
          const data = await res.json();

          console.log("Schedules data:", data);

          if (data.success) {
            populateScheduleGrid(data.schedules || []);
            loadBarberPresence();
          } else {
            showModal("Failed to load schedules: " + (data.error || "Unknown error"));
          }
        } catch (err) {
          showModal("Failed to load schedules");
          console.error("Load schedules error:", err);
        } finally {
          // Remove loading state
          const scheduleGrid = document.getElementById("schedule-grid");
          scheduleGrid.classList.remove("loading");
        }
      }

      // Populate the schedule grid with timeslot data
      function populateScheduleGrid(schedules) {
        const scheduleGrid = document.getElementById("schedule-grid");
        scheduleGrid.innerHTML = "";

        if (!schedules || schedules.length === 0) {
          scheduleGrid.innerHTML = "<p style='color: #ffffff; text-align: center; padding: 20px;'>No schedules available for this date.</p>";
          return;
        }

        // Group schedules by barber
        const barberSchedules = {};
        schedules.forEach(schedule => {
          if (!barberSchedules[schedule.barber_name]) {
            barberSchedules[schedule.barber_name] = [];
          }
          barberSchedules[schedule.barber_name].push(schedule);
        });

        // Create schedule display for each barber
        Object.keys(barberSchedules).forEach(barberName => {
          const barberDiv = document.createElement("div");
          barberDiv.className = "barber-schedule";
          
          const barberNameDiv = document.createElement("div");
          barberNameDiv.className = "barber-name";
          barberNameDiv.textContent = barberName;
          barberDiv.appendChild(barberNameDiv);

          barberSchedules[barberName].forEach(slot => {
            // Use actual_availability if available, otherwise fallback to is_available
            const isAvailable = slot.actual_availability !== undefined ? slot.actual_availability : slot.is_available;
            
            const timeSlotDiv = document.createElement("div");
            timeSlotDiv.className = `time-slot ${isAvailable ? 'available' : 'unavailable'}`;
            timeSlotDiv.innerHTML = `
              <div class="slot-time">${slot.time}</div>
              <div class="slot-actions">
                <button class="toggle-btn ${isAvailable ? 'available' : ''}" 
                        onclick="toggleAvailability(${slot.id}, ${!isAvailable})">
                  ${isAvailable ? 'Available' : 'Disable'}
                </button>
                <button class="edit-timeslot-btn" 
                        onclick="startEditTimeslot(${slot.id}, '${slot.time}')">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="delete-timeslot-btn" 
                        onclick="deleteTimeslot(${slot.id})"
                        data-slot-id="${slot.id}">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <div id="edit-form-${slot.id}" class="timeslot-edit-form">
                <input type="text" id="edit-time-${slot.id}" value="${slot.time}" placeholder="e.g., 09:00 AM" />
                <button class="save-timeslot-btn" onclick="saveTimeslotEdit(${slot.id})">Save</button>
                <button class="cancel-timeslot-btn" onclick="cancelTimeslotEdit(${slot.id})">Cancel</button>
              </div>
            `;
            barberDiv.appendChild(timeSlotDiv);
          });

          scheduleGrid.appendChild(barberDiv);
        });
      }

      // Load barber presence management
      async function loadBarberPresence() {
        try {
          const selectedDate = document.getElementById("schedule-date").value;
          const url = selectedDate 
            ? `/api/admin/barbers?date=${selectedDate}`
            : "/api/admin/barbers";
            
          const res = await fetch(url);
          const data = await res.json();

          if (data.success) {
            const presenceList = document.getElementById("barber-presence-list");
            presenceList.innerHTML = "";

            // Also populate the barber select dropdown
            const barberSelect = document.getElementById("timeslot-barber-select");
            barberSelect.innerHTML = '<option value="">Choose a barber...</option>';

            data.barbers.forEach((barber) => {
              const presenceItem = document.createElement("div");
              presenceItem.className = `presence-item ${barber.is_present ? "present" : "absent"}`;
              // Use barber.profile_pic directly if present, else default-profile.svg
              let photoUrl = 'default-profile.svg';
              if (barber.profile_pic && barber.profile_pic.trim() !== "") {
                photoUrl = barber.profile_pic;
              }
              presenceItem.innerHTML = `
                <img src="${photoUrl}" alt="${barber.name}" class="barber-avatar" />
                <span>${barber.name}</span>
                <button class="presence-toggle ${barber.is_present ? "" : "absent"}"
                        onclick="event.stopPropagation(); toggleBarberPresence(${barber.id}, ${!barber.is_present})">
                  ${barber.is_present ? "Present" : "Absent"}
                </button>
              `;
              

              
              presenceList.appendChild(presenceItem);

              // Add to barber select dropdown
              const option = document.createElement("option");
              option.value = barber.id;
              option.textContent = barber.name;
              barberSelect.appendChild(option);
            });
          }
        } catch (err) {
          console.error("Failed to load barber presence:", err);
        }
      }





      // Function to validate time range
      function isTimeInRange(timeStr) {
        // Convert time string to 24-hour format for comparison
        const [time, period] = timeStr.split(' ');
        let [hours, minutes] = time.split(':');
        hours = parseInt(hours);
        
        // Convert to 24-hour format
        if (period.toLowerCase() === 'pm' && hours !== 12) {
          hours += 12;
        } else if (period.toLowerCase() === 'am' && hours === 12) {
          hours = 0;
        }

        // Create Date objects for comparison
        const inputTime = new Date();
        inputTime.setHours(hours, parseInt(minutes), 0);

        const openTime = new Date();
        openTime.setHours(10, 0, 0); // 10:00 AM

        const closeTime = new Date();
        closeTime.setHours(20, 0, 0); // 8:00 PM

        return inputTime >= openTime && inputTime <= closeTime;
      }

      // Add new timeslot
      async function addNewTimeslot() {
        const barberId = document.getElementById("timeslot-barber-select").value;
        const time = document.getElementById("timeslot-time-input").value.trim();
        const availableDate = document.getElementById("timeslot-date-input").value;

        if (!barberId) {
          showModal("Please select a barber");
          return;
        }

        if (!time) {
          showModal("Please enter a time");
          return;
        }

        // Validate time format
        const timeRegex = /^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM)$/i;
        if (!timeRegex.test(time)) {
          showModal("Invalid time format. Use format like '09:00 AM' or '02:30 PM'");
          return;
        }

        // Validate time range
        if (!isTimeInRange(time)) {
          showModal("Time must be between 10:00 AM and 8:00 PM");
          return;
        }

        try {
          const res = await fetch("/api/admin/add-timeslot", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
              barberId: parseInt(barberId), 
              time: time,
              availableDate: availableDate || null
            }),
          });

          const result = await res.json();
          if (result.success) {
            showModal(result.message);
            // Clear form and reload schedules after user clicks OK
            document.getElementById("modal-ok").addEventListener("click", function() {
              document.getElementById("timeslot-barber-select").value = "";
              document.getElementById("timeslot-time-input").value = "";
              document.getElementById("timeslot-date-input").value = "";
              loadSchedules();
            }, { once: true });
          } else {
            showModal(result.error || "Failed to add timeslot");
          }
        } catch (err) {
          showModal("An error occurred");
          console.error(err);
        }
      }

      // Start editing a timeslot
      function startEditTimeslot(timeslotId, currentTime) {
        const editForm = document.getElementById(`edit-form-${timeslotId}`);
        const timeInput = document.getElementById(`edit-time-${timeslotId}`);
        
        editForm.style.display = "block";
        timeInput.value = currentTime;
        timeInput.focus();
      }

      // Cancel editing a timeslot
      function cancelTimeslotEdit(timeslotId) {
        const editForm = document.getElementById(`edit-form-${timeslotId}`);
        editForm.style.display = "none";
      }

      // Save timeslot edit
      async function saveTimeslotEdit(timeslotId) {
        const timeInput = document.getElementById(`edit-time-${timeslotId}`);
        const newTime = timeInput.value.trim();

        if (!newTime) {
          showModal("Please enter a time");
          return;
        }

        // Validate time format
        const timeRegex = /^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM)$/i;
        if (!timeRegex.test(newTime)) {
          showModal("Invalid time format. Use format like '09:00 AM' or '02:30 PM'");
          return;
        }

        // Validate time range
        if (!isTimeInRange(newTime)) {
          showModal("Time must be between 10:00 AM and 8:00 PM");
          return;
        }

        try {
          const res = await fetch("/api/admin/update-timeslot", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
              timeslotId: timeslotId, 
              time: newTime
            }),
          });

          const result = await res.json();
          if (result.success) {
            showModal(result.message);
            // Reload schedules after user clicks OK
            document.getElementById("modal-ok").addEventListener("click", function() {
              loadSchedules();
            }, { once: true });
          } else {
            showModal(result.error || "Failed to update timeslot");
          }
        } catch (err) {
          showModal("An error occurred");
          console.error(err);
        }
      }

      // Delete timeslot (IMPROVED)
      async function deleteTimeslot(timeslotId) {
        console.log("Delete timeslot called with ID:", timeslotId);
        
        // Validate timeslotId
        if (!timeslotId || isNaN(timeslotId)) {
          showModal("Invalid timeslot ID");
          console.error("Invalid timeslot ID:", timeslotId);
          return;
        }

        try {
          // Check if this is a booked slot by looking at the button's parent element
          const deleteBtn = document.querySelector(`[data-slot-id="${timeslotId}"]`);
          const timeSlot = deleteBtn.closest('.time-slot');
          const isBookedSlot = timeSlot.classList.contains('booked');
          
          // Show different confirmation messages based on booking status
          const confirmMessage = isBookedSlot 
            ? "⚠️ WARNING: This timeslot is currently BOOKED by a customer. Deleting it will cancel their appointment. Are you absolutely sure you want to proceed?"
            : "Are you sure you want to delete this timeslot? This action cannot be undone.";
          
          const confirmed = await showConfirmModal(confirmMessage);
          
          if (!confirmed) {
            console.log("Delete cancelled by user");
            return;
          }

          console.log("Proceeding with delete for timeslot ID:", timeslotId);

          // Disable the delete button to prevent double-clicks
          if (deleteBtn) {
            deleteBtn.disabled = true;
            deleteBtn.textContent = "Deleting...";
          }

          const res = await fetch("/api/admin/delete-timeslot", {
            method: "POST",
            headers: { 
              "Content-Type": "application/json",
              "Cache-Control": "no-cache"
            },
            body: JSON.stringify({ timeslotId: parseInt(timeslotId) }),
          });

          console.log("Delete response status:", res.status);
          
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }

          const result = await res.json();
          console.log("Delete response:", result);

          if (result.success) {
            showModal(result.message || "Timeslot deleted successfully");
            // Reload schedules after user clicks OK
            document.getElementById("modal-ok").addEventListener("click", function() {
              loadSchedules();
            }, { once: true });
          } else {
            showModal(result.error || "Failed to delete timeslot");
            // Re-enable button on error
            if (deleteBtn) {
              deleteBtn.disabled = false;
              deleteBtn.textContent = "Delete";
            }
          }
        } catch (err) {
          console.error("Delete timeslot error:", err);
          showModal("An error occurred while deleting the timeslot: " + err.message);
          
          // Re-enable button on error
          const deleteBtn = document.querySelector(`[data-slot-id="${timeslotId}"]`);
          if (deleteBtn) {
            deleteBtn.disabled = false;
            deleteBtn.textContent = "Delete";
          }
        }
      }

      // Toggle barber presence
      async function toggleBarberPresence(barberId, isPresent) {
        try {
          const selectedDate = document.getElementById("schedule-date").value;
          
          if (!selectedDate) {
            showModal("Please select a date first");
            return;
          }

          const res = await fetch("/api/admin/update-barber-presence", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
              barberId, 
              isPresent,
              date: selectedDate 
            }),
          });

          const result = await res.json();
          if (result.success) {
            loadBarberPresence(); // Reload presence list
            loadSchedules(); // Reload schedules to reflect changes
          } else {
            showModal(result.error || "Failed to update barber presence");
          }
        } catch (err) {
          showModal("An error occurred");
          console.error(err);
        }
      }

      // Toggle barber availability
      async function toggleAvailability(timeslotId, isAvailable) {
        try {
          const selectedDate = document.getElementById("schedule-date").value;
          
          if (!selectedDate) {
            showModal("Please select a date first");
            return;
          }

          console.log("Toggling availability:", { timeslotId, isAvailable, selectedDate });

          const res = await fetch("/api/admin/update-barber-schedule", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              timeslotId: parseInt(timeslotId),
              isAvailable: isAvailable,
              availableDate: selectedDate,
            }),
          });

          const result = await res.json();
          console.log("Toggle response:", result);

          if (result.success) {
            // Reload schedules to reflect the changes
            await loadSchedules();
          } else {
            showModal(result.error || "Failed to update schedule");
          }
        } catch (err) {
          console.error("Toggle availability error:", err);
          showModal("An error occurred while updating availability");
        }
      }

      // Logout: handled by centralized logout-confirm.js
      // logout-confirm.js intercepts clicks on #logoutBtn and shows confirmation modal

      // Load schedules and barber presence on page load
      loadSchedules();
      loadBarberPresence();
        // ========== ADMIN NOTIFICATION BELL (Now handled by shared manager) ==========
        // The notification functionality is now handled by admin-notifications.js
    </script>
  <!-- Shared Admin Notification Manager -->
  <script src="admin-notifications.js"></script>
  <script src="logout-confirm.js"></script>
  </body>
</html>
